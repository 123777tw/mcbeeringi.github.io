<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>desktop</title>
	</head>
	<body>
		<style>
			:root{font-family:sans-serif;background-color:#333;color:#fff;}
			body{position:relative;}
			div.window{background-color:#444;border-radius:4px;box-shadow:0 0 4px #0008;position:absolute;overflow:hidden;padding-bottom:14px;min-width:128px;min-height:32px;}
			header{background:#8888;color:#fff;text-shadow:0 0 2px #444;user-select:none;-webkit-user-select:none;text-align:center;}
			header.grab{background:#888;}
			footer{position:absolute;bottom:0;right:0;width:14px;height:14px;}
		</style>


		<div name="test" class="window" style="top:120px;left:100px;">
			aaa <br>
			bbb
		</div>
		<div name="test2" class="window" style="top:90px;">
			<textarea></textarea>
		</div>

		<pre id="log"></pre>
		<script>
			var windows = document.body.querySelectorAll("div.window"),hbf=[],hcr=[],tflag=false;
			console.log(windows);
			windows.forEach((e,i)=>{
				var hbar = document.createElement('header');
				hbar.insertAdjacentHTML("beforeend",e.getAttribute("name"));
				hbar.setAttribute('class','hbar');
				hbar.ontouchstart=(m)=>{
					tflag=true;
					hbar.classList.add('grab');
					hbf[i]=[e.style.left?Number(e.style.left.replace("px","")):0,m.changedTouches[0].clientX,e.style.top?Number(e.style.top.replace("px","")):0,m.changedTouches[0].clientY];
					hcr=[e,i];console.log("tdown",hbf[i]);
					document.body.style.userSelect="none";document.body.style.WebkitUserSelect="none";
				}
				hbar.ontouchend=()=>{
					hbar.classList.remove('grab');
					document.body.style.userSelect="auto";document.body.style.WebkitUserSelect="auto";
				}
				hbar.onmousedown=(m)=>{
					if(tflag)tflag=false;
					else{
						hbar.classList.add('grab');
						hbf[i]=[e.style.left?Number(e.style.left.replace("px","")):0,m.clientX,e.style.top?Number(e.style.top.replace("px","")):0,m.clientY];
						hcr=[e,i];console.log("mdown",hbf[i]);
						document.body.style.userSelect="none";document.body.style.WebkitUserSelect="none";
					}
				}
				hbar.onmouseup=()=>{
					hbar.classList.remove('grab');
					document.body.style.userSelect="auto";document.body.style.WebkitUserSelect="auto";
				}
				e.insertBefore(hbar,e.firstChild);

				var fbar = document.createElement('footer');
				fbar.insertAdjacentHTML("beforeend",'<svg><polygon points="0,0 0,14 14,14 14,0" fill="#aaa"></polygon><polygon points="0,14 0,0 14,0" fill="#888"></polygon></svg>');
				e.appendChild(fbar);
			});
			window.ontouchmove=(m)=>{
				if(hcr[0].firstChild.classList.contains("grab")){
					console.log("mmove");
					hcr[0].style.left=hbf[hcr[1]][0]+m.changedTouches[0].clientX-hbf[hcr[1]][1]+"px";
					hcr[0].style.top=hbf[hcr[1]][2]+m.changedTouches[0].clientY-hbf[hcr[1]][3]+"px";
				}
			}
			window.onmousemove=(m)=>{
				if(hcr[0].firstChild.classList.contains("grab")){
					console.log("mmove");
					hcr[0].style.left=hbf[hcr[1]][0]+m.clientX-hbf[hcr[1]][1]+"px";
					hcr[0].style.top=hbf[hcr[1]][2]+m.clientY-hbf[hcr[1]][3]+"px";
				}
			}

			log.innerText = "test";
		</script>
	</body>
</html>
