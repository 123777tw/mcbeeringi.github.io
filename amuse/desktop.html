<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>desktop</title>
	</head>
	<body>
		<style>
			:root{font-family:sans-serif;background-color:#444;color:#fff;overflow:hidden;}
			body{position:relative;margin:16px;}
			div.window>div{background-color:#222;border-radius:4px;box-shadow:0 0 8px #0008,0 0 2px #fff8 inset;position:absolute;overflow:hidden;padding-bottom:16px;min-width:128px;min-height:32px;}
			.hbar,.fbar{user-select:none;-webkit-user-select:none;text-align:center;touch-action:none;}
			.hbar{background:#6668;color:#fff;text-shadow:0 0 2px #444;font-size:16px;}.fbar{position:absolute;bottom:0;right:0;width:16px;height:16px;}
			.hbar.grab,.fbar.grab{background:#8888;}
			#log{margin:0;}
		</style>

		<div class="window">
			<div name="test" style="top:60px;left:50px;width:200px;height:150px;">
				pcみたいな <br>
				ウィンドウの操作が <br>
				できるやつ
			</div>
			<div name="test2" style="top:240px;left:200px;width:200px;height:150px;">
				<textarea>中身はただのhtml
右下ドラッグでリサイズ</textarea>
			</div>
		</div>

		<pre id="log"></pre>
		<script>
			var wtmp=[],wcr=[],tflag=false;
			const cmargin=Number(window.getComputedStyle(document.body).margin.replace("px",""));
			document.body.querySelectorAll("div.window>div").forEach((e,i)=>{
				//header bar pre post
				var hbar = document.createElement('header');
				hbar.insertAdjacentHTML("beforeend",e.getAttribute("name"));
				hbar.setAttribute('class','hbar');
				hbar.ontouchstart=(m)=>{
					tflag=true;
					hbar.classList.add('grab');
					wtmp[i]=[e.style.left?Number(e.style.left.replace("px","")):0,m.changedTouches[0].clientX,e.style.top?Number(e.style.top.replace("px","")):0,m.changedTouches[0].clientY];
					wcr=[e,i];document.body.style.userSelect="none";document.body.style.WebkitUserSelect="none";
				}
				hbar.onmousedown=(m)=>{
					if(tflag)tflag=false;
					else{
						hbar.classList.add('grab');
						wtmp[i]=[e.style.left?Number(e.style.left.replace("px","")):0,m.clientX,e.style.top?Number(e.style.top.replace("px","")):0,m.clientY];
						wcr=[e,i];document.body.style.userSelect="none";document.body.style.WebkitUserSelect="none";
					}
				}
				e.insertBefore(hbar,e.firstChild);

				//footer bar pre post
				var fbar = document.createElement('footer');
				fbar.insertAdjacentHTML("beforeend",'<svg><polygon points="0,0 0,16 16,16 16,0" fill="#6668"></polygon><polygon points="0,16 16,16 16,0" fill="#8888"></polygon></svg>');
				fbar.setAttribute('class','fbar');
				fbar.ontouchstart=(m)=>{
					tflag=true;
					fbar.classList.add('grab');
					wtmp[i]=[Number(window.getComputedStyle(e).width.replace("px","")),m.changedTouches[0].clientX,Number(window.getComputedStyle(e).height.replace("px","")),m.changedTouches[0].clientY];
					wcr=[e,i];document.body.style.userSelect="none";document.body.style.WebkitUserSelect="none";
				}
				fbar.onmousedown=(m)=>{
					if(tflag)tflag=false;
					else{
						fbar.classList.add('grab');
						wtmp[i]=[Number(window.getComputedStyle(e).width.replace("px","")),m.clientX,Number(window.getComputedStyle(e).height.replace("px","")),m.clientY];
						wcr=[e,i];document.body.style.userSelect="none";document.body.style.WebkitUserSelect="none";
					}
				}
				e.appendChild(fbar);

				//front controll
				e.ontouchstart=()=>{if(wcr[0]!=e)document.body.querySelectorAll("div.window")[0].appendChild(e);}
				e.onmousedown=()=>{if(wcr[0]!=e)document.body.querySelectorAll("div.window")[0].appendChild(e);}
			});
			const onpost=()=>{if(wcr[0]){wcr[0].firstChild.classList.remove('grab');wcr[0].lastChild.classList.remove('grab');}document.body.style.userSelect="auto";document.body.style.WebkitUserSelect="auto";}
			window.ontouchend=()=>{onpost();};window.ontouchcancel=()=>{onpost();};window.onmouseup=()=>{onpost();};
			window.ontouchmove=(e)=>{
				if(wcr[0].firstChild.classList.contains("grab")){//move
					e.preventDefault();
					wcr[0].style.left=Math.min(Math.max(wtmp[wcr[1]][0]+e.changedTouches[0].clientX-wtmp[wcr[1]][1],-Number(window.getComputedStyle(wcr[0]).width.replace("px",""))),window.innerWidth-cmargin*2)+"px";
					wcr[0].style.top=Math.min(Math.max(wtmp[wcr[1]][2]+e.changedTouches[0].clientY-wtmp[wcr[1]][3],-cmargin),window.innerHeight-cmargin-14)+"px";
				}else if(wcr[0].lastChild.classList.contains("grab")){//resize
					e.preventDefault();
					wcr[0].style.width=wtmp[wcr[1]][0]+e.changedTouches[0].clientX-wtmp[wcr[1]][1]+"px";
					wcr[0].style.height=wtmp[wcr[1]][2]+e.changedTouches[0].clientY-wtmp[wcr[1]][3]+"px";
				}
			}
			window.onmousemove=(e)=>{
				if(wcr[0].firstChild.classList.contains("grab")){//move
					wcr[0].style.left=Math.min(Math.max(wtmp[wcr[1]][0]+e.clientX-wtmp[wcr[1]][1],-Number(window.getComputedStyle(wcr[0]).width.replace("px",""))),window.innerWidth-cmargin*2)+"px";
					wcr[0].style.top=Math.min(Math.max(wtmp[wcr[1]][2]+e.clientY-wtmp[wcr[1]][3],-cmargin),window.innerHeight-cmargin-14)+"px";
				}else if(wcr[0].lastChild.classList.contains("grab")){//resize
					wcr[0].style.width=wtmp[wcr[1]][0]+e.clientX-wtmp[wcr[1]][1]+"px";
					wcr[0].style.height=wtmp[wcr[1]][2]+e.clientY-wtmp[wcr[1]][3]+"px";
				}
			}

			log.innerText = "welcome to html desktop!";
		</script>
	</body>
</html>
