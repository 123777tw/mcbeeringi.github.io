<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<style>:root{background:#222;color:#fff;}</style>
		<a href="../src/petitgl.js">PetitGL</a>
		<script src="../src/petitgl.js"></script>
		<script>
			const t0=new Date();
				main=new PetitGL()
				.resize(800,512)
				.compile(
					'test',//program name
					`attribute vec2 UV;void main(){gl_Position=vec4(UV,0,1);}`,//vsh
					`precision mediump float;
					uniform highp float time;
					uniform vec2 res;
					uniform sampler2D tex0;
					mat2 rot(float t){return mat2(cos(t),-sin(t),sin(t),cos(t));}
					vec3 img(sampler2D tex,vec2 p,vec3 r){//r = vec3(radius,rot,rot per col)
						p=(p-.5)*rot(r.y);
						vec2 rt=vec2(0,-r.x);
						mat2 r120=mat2(-.5,-.866,.866,-.5);
						mat2 rz=rot(r.z);
						vec2 pr=p+rt;rt*=r120;
						vec2 pg=p+rt;rt*=r120;
						vec2 pb=p+rt;
						return vec3(
							texture2D(tex,pr*rz+.5).r,
							texture2D(tex,pg*rz+.5).g,
							texture2D(tex,pb*rz+.5).b
						);
					}
					void main(){
						vec2 p=gl_FragCoord.xy/res;
						vec3 diffuse=img(tex0,p,vec3(sin(time)*.1,time*.25,-time*.25));
						diffuse=pow(diffuse,sin(time+vec3(0,2.1,4.2))*.25+.5);
						gl_FragColor=vec4(diffuse,1);
					}`//fsh
				)
				.att(
					'test',//program name
					[//attriubte list
						{name:'UV',data:[-1,-1, 1,-1, -1,1, 1,1],length:2},
						{name:'COLOR',data:[1,0,0,1, 0,1,0,1, 0,0,1,1, 1,1,1,1],length:4}
					],
					[0,1,2, 3,2,1]//index
				)
				.defUni(
					'test',
					[
						{name:'time',type:'float'},
						{name:'tex0',type:'tex'},
						{name:'tex0res',type:'vec2'},
						{name:'res',type:'vec2'}
					]
				).tex(
					[
						{texname:'sky',url:'../img/tateshina.png'}
					]
				),
				loop=()=>{
					requestAnimationFrame(loop);
					main
					.draw('test')
					.uni(
						'test',
						[
							{name:'time',data:[(new Date()-t0)*.001]},
							{name:'tex0',data:'sky',rname:'tex0res'},
							{name:'res',data:[main.c.width,main.c.height]}
						]
					);
				};loop();
				document.body.appendChild(main.c);
		</script>
	</body>
</html>
