<html>
	<head>
		<meta charset="utf-8">
		<!--iOS-->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="default">
		<meta name="apple-mobile-web-app-title" content="OCR">
		<link rel="apple-touch-icon" href="pwa/corn.png">
		<!--sw-->
		<link rel="manifest" href="pwa/ocr_manifest.json">
		<script>
			if ('serviceWorker' in navigator){navigator.serviceWorker.register('pwa/ocr_sw.js').then((reg) => {console.log('Service worker registered.', reg);});}
		</script>

		<script src="https://unpkg.com/tesseract.js@v2.0.2/dist/tesseract.min.js"></script>
		<script>
			Tesseract.recognize("../img/6x6.png","jpn+eng",{
				logger:(m) => {
					console.log(m);
					document.getElementById("load").innerText += m.status+": "+m.progress*100+"%\n";
				}}).then(
					({data:{text}}) => {
						document.getElementById("stuff").style.display="block";
						document.getElementById("load").style.display="none";
					}
				);
			var reader = new FileReader();
		</script>
		<style>
			*{font-family:sans-serif;}
			label.file{
				display: block;
				width: 60%;
				background-color: #eee;
				text-align: center;
				padding: 20%;
				border: solid 2px #888;
				border-radius: 7px;
			}
			input[type=file]{display:none;}
			.bar{width:50%;height:10px;background-color:#eee;border-radius:5px;overflow:hidden;}
			.bar *{width:0;height:10px;background-color:#38f;}
		</style>
	</head>
	<body>
		<h1>OCR!</h1>
		<div id="load">
			Please wait… <br><br>
		</div>
		<div id="stuff" style="display:none;">
			<label class="file">
				D&amp;D又はクリックして選択<br>
				<input type="file" name="img" accept="image/png, image/jpeg" onchange="
					fname.textContent=this.value.split('\\').pop();
					fname.textContent=fname.textContent?fname.textContent:'　';
					reader.readAsDataURL(this.files[0]);
					console.log(reader);
					document.getElementById('img').src = reader.result;
				">
				<div id="fname">　</div>
			</label>
			<img id="img" src="img/test.png" width=50% onclick='
				Tesseract.recognize(this,"jpn+eng",{
					logger:(m) => {
						console.log(m);
						document.getElementById("msg").innerText=m.status+"…";
						document.getElementById("bar").style.width = m.progress*100+"%";
					}}).then(
						({data:{text}}) => {
							document.getElementById("msg").textContent="done!";
							document.getElementById("s").textContent=text;
						}
					);
			'>
			<div id="msg">　</div>
			<div class="bar">
				<div id="bar" style=""></div>
			</div>
			<div id="s"></div>
		</div>
		</body>
</html>
