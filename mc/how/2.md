# #2 型と演算子
[<< #1 準備](?i=1)  
[トップ](?)  
[#3 HelloWorld >>](?i=3)

## index
- 型
- 演算子
	- 代入演算子
	- スウィズル演算子

2019/11/20作成  
2021/11/26更新

---
## 型
マイクラの用いるシェーディング言語  
glsl,hlslはC言語をベースにした言語です  
float,intなどのお馴染みの型に加えて  
vec,matなどのベクトル(色,座標)や行列の計算専用の型が用意されています  
以下普段使うものを抜粋

- 浮動小数点数
	- glsl **float**
		```
		float a=1.;
		a=1; // Error
		```
	- hlsl **float**  
			glslとほぼ同じ
- 整数
	- glsl **int**
		```
		int a=1;
		a=1.; // Error
		```
	- hlsl **int**  
			glslとほぼ同じ
- 真偽値
	- glsl **bool**
		```
		bool a=true;
		a=false;
		```
	- hlsl **bool**  
		glslとほぼ同じ
- ベクトル  
	浮動小数点数が任意個集まったやつ
	glslとhlslでの型変換周りの仕様の違いが厄介
	- glsl **vec(2,3,4)**
		```
		vec2 a=vec2(1.,2.);
		a=vec2(1); //vec2(1.0,1.0)と等価
		a=1.; //Error
		```
	- hlsl **float(2,3,4)**
		```
		float2 a=float2(1.,2.);
		a=1.; //vec2(1.0,1.0)と等価 dousite???
		a=float2(1.); //Error は？？？？？？？
		```
- 行列  
	ベクトルが任意個集まったやつ  
	紙に書くと長方形の数字の塊  
	glslとhlslでの演算子周りの仕様の違いが厄介  
	座標系の違いも厄介(意識することは少ない)  
	なにができるの？  
	→強そうな言い方をすると掛け算することで空間の移動,回転,歪めが一発でできる  
	→かけるかかけられるかで計算結果が変わるので注意
	- glsl **mat(2,3,4)**  
		正方行列(数字の塊が正方形)のみ  
		要素数は名前の二乗
		```
		mat2 a=mat2(1.,3.,2.,4.);
		a=a*a; //行列の掛け算
		```
	- hlsl **floatNxN**(N=1~4)  
		正方行列以外もOKだけどあまり使わない
		```
		float2x2 a=float2x2(1.,2.,3.,4.);
			//上のglslと同じ行列を表す cf.座標系(数学)
		a=mul(a,a); //行列の掛け算 関数については後の章にて扱う予定
		```

C言語と違う点は暗黙の型変換が直接行われないことでしょうか  
floatは小数点付けないだけで動かない&見逃しがちなので注意  

ここからは基本glslを使って解説していきます  
断りのない限りhlslも同じなので安心してください  

## 演算子
普段使う四則演算がそのまま使える  
計算順序も乗除が先というのはいつも通り  
記号はそれぞれ  
```
加減乗除
+ - * /
```
異なる型同士で演算することも可能だが  
計算方法が一通りに定まらない場合はエラーが出る  
最悪の場合端末ごとに違う動きをして  
自分は気づかないこともある(glslあるある)  
```
vec2(1)+vec2(1); //OK
vec2(1)+1.0; //OK vecの中身はfloat floatがvecに変換されたような挙動をする
vec2(1)+vec3(1); //Error 二個と三個の要素をどう扱うかは一通りではない
vec2(1)+1; //Error vecの中身はfloatでありintではない
```

ところでC言語では%で余剰を計算できるが  
glsl,hlslには存在しない(処理が重いから)  
後の章で解説する関数で同党の計算は実現できる  

### 代入演算子
知っている人はお馴染み  
決まったパターンを省略して書ける
```
a=a+b;
```
を
```
a+=b;
```
に縮められる  
処理に違いはない  
四則演算すべてに用意されている
```
+= -= *= /=
```

### スウィズル(swizzle)演算子
いかつい名前してますが大したことないです  
はっきり言って演算子なのかも怪しいです  
vec型のn番目の数字だけ取り出したい!って時に使うものです  
vec型の数の後にこれを書くことで機能します  

- 空間座標  
	x, y, z, w
- 色  
	r, g, b, a
- テクスチャ座標  
	s, t, p, q

座標のwは拡大率を表すのだとか  
座標の計算の時に必ずxyzの演算子を使わなくても  
併用する演算子が同じ列の中のものなら大丈夫です  
説明しづらいので例を  
```
vec4 a = vec4(1.0, 2.0, 3.0, 4.0);
vec2 b = a.xy; //b = vec2(1.0, 2.0);
b = a.aa; //b = vec2(4.0, 4.0); 同じ要素を複数回使うのもok
b = a.xs; //異なる組のスウィズル演算子を使うことはできない
vec3 c = a.zxz; //b = vec3(3.0, 1.0, 3.0);
float d = b.s+c.p; //d = 4.0+1.0; つまり5.0
```

---
予想以上に長くなったので今回はここまで  
次回"Hello World"する予定です  
お楽しみに!