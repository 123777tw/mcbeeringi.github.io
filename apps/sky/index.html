<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>sky instruments</title>
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<!--iOS-->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="default">
		<meta name="apple-mobile-web-app-title" content="sky instr">
		<link rel="apple-touch-icon" href="sky_512.png">
		<!--sw-->
		<link rel="manifest" href="sky_manifest.json">
		<script>
			if('serviceWorker' in navigator)navigator.serviceWorker.register('sky_sw.js').then((reg)=>{console.log('Service worker registered.', reg);});
		</script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.5.45/Tone.js"></script>
		<style>
			:root{background:#444 linear-gradient(#cce5f0,#ced980);background-repeat:no-repeat;height:100%;user-select:none;-webkit-user-select:none;pointer-events:none;font-family:sans-serif;}
			html,body{height:100%;position:relative;}
			#kb{touch-action:none;margin:0 auto;}
			td{width:83px;height:83px;}
			td div{width:70px;height:70px;background-color:#aaa;border-radius:16px;box-shadow:0 0 10px #aaa;position:relative;cursor:pointer;margin:0 auto;transition:.1s;}
			td div::before, td div::after{display:block;position:absolute;animation:bob 1.2s ease-in-out 0s infinite alternate;border:2px solid #fea;box-shadow:0 0 4px #fea8, 0 0 4px #fea8 inset;transition:0;}
			td:nth-child(2n) div::before{content:"";top:18px;left:18px;width:30px;height:30px;}
			td:nth-child(2n-1) div::after{content:"";top:13px;left:13px;width:40px;height:40px;border-radius:50%;}
			td div.c::before, td div.c::after{content:"";top:15px;left:15px;width:36px;height:36px;}
			td div.on{transform:scale(.8,.8);}td div.on::before, td div.on::after{animation:on .4s ease-in-out;transform:rotateY(0deg)rotateZ(45deg);}
			form{width:100%;display:flex;justify-content:center;flex-wrap:wrap;top:100%;position:absolute;}
			input[type=radio]{display:none;}
			form div{width:64px;height:64px;margin:8px;border-radius:16px;background-color:#aaa;}
			form input[type=radio]:checked+div{position:relative;top:-2px;left:-2px;border:2px solid #fea;}
			@keyframes bob{
				0%{transform:rotateZ(45deg)scale(1,1);}
				100%{transform:rotateZ(45deg)scale(1.1,1.1);}
			}
			@keyframes on{
				0%{transform:rotateY(0deg)rotateZ(45deg);}
				100%{transform:rotateY(360deg)rotateZ(45deg);}
			}
		</style>
	</head>
	<body>
		<table id="kb">
			<tr><td><div class="c" id="c4"></div></td><td><div id="d4"></div></td><td><div id="e4"></div></td><td><div id="f4"></div></td><td><div  id="g4"></div></td></tr>
			<tr><td><div id="a4"></div></td><td><div id="b4"></div></td><td><div class="c" id="c5"></div></td><td><div id="d5"></div></td><td><div id="e5"></div></td></tr>
			<tr><td><div id="f5"></div></td><td><div id="g5"></div></td><td><div id="a5"></div></td><td><div id="b5"></div></td><td><div class="c" id="c6"></div></td></tr>
		</table>
		<form id="instr_" onchange="set();">
			<label><input type="radio" name="instr" value="0" checked><div>A</div></label>
			<label><input type="radio" name="instr" value="1"><div>Pianno</div></label>
			<label><input type="radio" name="instr" value="2"><div>フルート</div></label>
			<label><input type="radio" name="instr" value="3"><div>鉄琴</div></label>
			<label><input type="radio" name="instr" value="4"><div>ギター</div></label>
			<label><input type="radio" name="instr" value="5"><div>ハープ</div></label>
			<label><input type="radio" name="instr" value="6"><div>ホーン</div></label>
			<label><input type="radio" name="instr" value="7"><div>ピアノ</div></label>
			<label><input type="radio" name="instr" value="8"><div>ケーナ</div></label>
			<label><input type="radio" name="instr" value="9"><div>ウクレレ</div></label>
		</form>
		<script>
			var instr_li = ["APPiano","Contrabass","Flute","Glock","Guitar","Harp","Horn","Piano","Quena","Ukulele"];
			if(location.hash){instr_.instr[5].checked=false;instr_.instr[parseInt(location.hash.slice(1))].checked=true;}
			function set() {
				kb.style.opacity="0.2";kb.style.pointerEvents="none";
				instr_.style.opacity="0.2";instr_.style.pointerEvents="none";
				location.hash = instr_.instr.value;
				synth = new Tone.Sampler({"A4":"instr/"+instr_li[instr_.instr.value]+"_a4.mp3"},()=>{
					kb.style.opacity="1";kb.style.pointerEvents="auto";
					instr_.style.opacity="1";instr_.style.pointerEvents="auto";
					console.log(instr_li[instr_.instr.value]+"loaded");
				}).toDestination();
			}
			set();
			var key = document.querySelectorAll('table div');
			for(var i = 0; i < key.length; i++) {
				key[i].addEventListener("touchstart",function(e){e.preventDefault();this.textContent="　";console.log(this.id);synth.triggerAttackRelease(this.id);this.classList.add('on');},false);
				key[i].addEventListener("touchend",function(){this.classList.remove('on');},false);
				key[i].addEventListener("mousedown",function(){if(this.textContent=="　")this.textContent="";else{console.log(this.id);synth.triggerAttackRelease(this.id);this.classList.add('on');}},false);
				key[i].addEventListener("mouseup",function(){this.classList.remove('on');},false);
			}
		</script>
	</body>
</html>
