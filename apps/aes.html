<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>McbeEringi AES_encrypter</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
	<script>var reader = new FileReader();var name = "unknown";</script>
	<style>
		.file{width:320px;height:180px;position:relative;border-radius:5px;border:1px solid #888;}
		.file div{position:absolute;font-size:14px;top:calc(50% - 7px);width:100%;text-align:center;pointer-events:none;}
		.file input[type=file]{position:absolute;cursor:pointer;margin:0;width:100%;height:100%;opacity:0;}
	</style>
</head>
<body>
	<script src="../main.js"></script>
	<p class="title">AES_encrypter</p>

	<p align=center>入力したファイルを指定した鍵でAES暗号化し, それを埋め込んだhtmlファイルを生成します</p>
	<div class="col1">
		<label>key: <input id="key" type="text"></label><br>※メモすることをお勧めします<br><br>
		<div class="file"><input type="file" id="inp" onchange="file(this)"><div id="label">D&D又はクリックして選択</div></div>
	</div>
	<div class="col2">↓<br></div>
	<div class="col1">
		<a class="button" id="dl" download="">download</a>
	</div>
	<script>
		function file(_this) {
			name=_this.value.split("\\").pop();
			label.textContent="読み込み中…";
			reader.addEventListener("load", ()=>{label.textContent=name?"選択されたファイル: "+name:"D&D又はクリックして選択";main();}, false);
			reader.readAsDataURL(_this.files[0]);
		}
		function main(){
			var hash = CryptoJS.MD5(key.value).toString();
			var enc = CryptoJS.AES.encrypt(reader.result,key.value).toString();
			dl.download = name+"_aes.html";
			dl.href = "data:text/html,"+unescape("%3C%21DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3Cmeta%20charset%3D%27UTF-8%27%3E%3Ctitle%3EFILENAME%3C/title%3E%3Cscript%20src%3D%27https%3A//cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js%27%3E%3C/script%3E%3Cscript%3Econst%20data%3D")+
			'{"name":"'+name+'","hash":"'+hash+'","enc":"'+enc+'"}'+
			unescape("%3B%3C/script%3E%3C/head%3E%3Cbody%3E%3Ch1%20id%3D%27h1%27%3EFILENAME%3C/h1%3Ekey%3A%20%3Cinput%20id%3D%27key%27%20onchange%3D%27main%28%29%27%3E%3Cbr%3E%3Cspan%20id%3D%27log%27%3Einput%20password%20and%20press%20enter%3C/span%3E%3Cbr%3E%u2193%3Cbr%3E%3Ca%20id%3D%27opn%27%20href%3D%27javascript%3Avoid%280%29%3B%27%3Eopen%3C/a%3E%3Cbr%3E%3Ca%20download%3D%27FILENAME%27%20id%3D%27dl%27%20href%3D%27javascript%3Avoid%280%29%3B%27%3Edownload%3C/a%3E%3Cscript%3Edocument.title%3Ddata.name%3Bh1.innerText%3Ddata.name%3Bdl.download%3Ddata.name%3Bconst%20main%3D%28%29%3D%3E%7Bif%28CryptoJS.MD5%28key.value%29.toString%28%29%3D%3Ddata.hash%29%7Bopn.href%3DCryptoJS.AES.decrypt%28data.enc%2Ckey.value%29.toString%28CryptoJS.enc.Utf8%29%3Bdl.href%3Dopn.href%3Blog.innerText%3D%27validated%20%3A%29%27%3B%7Delse%7Bdl.href%3D%27javascript%3Avoid%280%29%3B%27%3Blog.innerText%3D%27illegal%20password%20%3A%28%27%3B%7D%7D%3C/script%3E%3C/body%3E%3C/html%3E");
		}
	</script>
</body>
</html>
