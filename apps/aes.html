<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>McbeEringi AES_encrypter</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
	<script>var reader = new FileReader();var name = "unknown";</script>
	<style>
		.file{width:320px;height:180px;position:relative;border-radius:5px;border:1px solid #888;}
		.file div{position:absolute;font-size:14px;top:calc(50% - 7px);width:100%;text-align:center;pointer-events:none;}
		.file input[type=file]{position:absolute;cursor:pointer;margin:0;width:100%;height:100%;opacity:0;}
	</style>
</head>
<body>
	<script src="../main.js"></script>
	<p class="title">AES_encrypter</p>

	<p align=center>入力したファイルを指定した鍵でAES暗号化し, それを埋め込んだhtmlファイルを生成します</p>
	<div class="col1">
		<div class="file"><input type="file" id="inp" onchange="file(this)"><div id="label">D&D又はクリックして選択</div></div>
	</div>
	<div class="col2">↓<br></div>
	<div class="col1">
		<label>key: <input id="key" type="text"></label><br>※メモすることをお勧めします<br>
		<span class="button" onclick="main();">generate</span><br>
	</div>
	<div class="col2">↓<br></div>
	<div class="col1">
		<a class="button" id="dl" download="">download</a>
	</div>
	<script>
		function file(_this) {
			name=_this.value.split("\\").pop();
			label.textContent="読み込み中…";
			reader.addEventListener("load", ()=>label.textContent=name?"選択されたファイル: "+name:"D&D又はクリックして選択", false);
			reader.readAsDataURL(_this.files[0]);
		}
		function main(){
			var hash = CryptoJS.MD5(key.value).toString();
			var enc = CryptoJS.AES.encrypt(reader.result,key.value).toString();
			dl.download = name+"_aes.html";
			dl.href = "data:text/html,"+unescape("%3C%21DOCTYPE%20html%3E%3Chtml%20lang%3D%22ja%22%3E%3Chead%3E%3Cmeta%20charset%3D%22utf-8%22%3E%3Ctitle%3E")+
				name+unescape("%3C/title%3E%3Cscript%20src%3D%22https%3A//cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js%22%3E%3C/script%3E%3C/head%3E%3Cbody%3E%3Ch1%3E")+
				name+unescape("%3C/h1%3Ekey%3A%20%3Cinput%20id%3D%22key%22%20onchange%3D%22main%28%29%22%3E%3Cbr%3E%3Cspan%20id%3D%22log%22%3E%u30D1%u30B9%u30EF%u30FC%u30C9%u3092%u5165%u529B%u3057%u3066%u304F%u3060%u3055%u3044%3C/span%3E%3Cbr%3E%u2193%3Cbr%3E%3Ca%20download%3D%22")+
				name+unescape("%22%20id%3D%22dl%22%20href%3D%22javascript%3Avoid%280%29%3B%22%3Edownload%3C/a%3E%3Cscript%3Evar%20data%3D")+
				"['"+hash+"','"+enc+"']"+unescape("%3Bfunction%20main%28%29%7Bif%28CryptoJS.MD5%28key.value%29.toString%28%29%3D%3Ddata%5B0%5D%29%7Blog.innerText%20%3D%20%22%u8A8D%u8A3C%u5B8C%u4E86%22%3Bdl.href%20%3D%20CryptoJS.AES.decrypt%28data%5B1%5D%2Ckey.value%29.toString%28CryptoJS.enc.Utf8%29%3B%7Delse%7Blog.innerText%20%3D%20%22%u30D1%u30B9%u30EF%u30FC%u30C9%u304C%u9593%u9055%u3063%u3066%u3044%u307E%u3059%22%3Bdl.href%20%3D%20%22javascript%3Avoid%280%29%3B%22%3B%7D%7D%3C/script%3E%3C/body%3E%3C/html%3E");
		}
	</script>
</body>
</html>
