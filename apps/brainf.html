<html>
<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-145066191-2"></script>
	<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config', 'UA-145066191-2');</script>
	<meta charset="utf-8">
	<title>McbeEringi brainf</title>
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="format-detection" content="telephone=no">
</head>
<body>
<style>
	:root,textarea{background:#222;color:#fff;font-family:monospace;user-select:none;-webkit-user-select:none;resize:none;}h1,h2{margin:4px;}
	#out{min-height:70px;overflow:scroll;background:#333;line-height:14px;padding:4px;user-select:text;-webkit-user-select:text;}
	.wrapper>*{padding:4px;margin-top:0;font-size:12px;word-break:break-all;}
	textarea{display:block;background:#333;border:1px solid #888;user-select:auto;-webkit-user-select:auto;}
	#mv{height:36px;overflow:scroll;white-space:nowrap;background:#333;position:relative;margin:2px;}
	#mv div,#mv p{width:32px;height:32px;margin:2px;border-radius:8px;}
	#mv div{position:absolute;top:0px;left:0;font-size:8px;background:#46f;z-index:1;/*transition:.05s;*/}
	#mv p{line-height:32px;vertical-align:top;text-align:center;display:inline-block;box-shadow:0 0 0 1px #888 inset;font-size:16px;z-index:2;position:relative;}
	.wrapper,.wrapper>textarea{position:relative;width:100%;z-index:1;}.wrapper>pre{position:absolute;top:0;left:0;right:0;white-space:pre-wrap;border:1px solid #0000;pointer-events:none;color:#0000;}
	.caret{color:#333;background:#fff;border-radius:1px;}
</style>

<h1>brainf***</h1>
<div id="mv"><div></div><p>0</p></div>
<pre id="out"></pre>
<button id="btn">run</button> <button id="stopb">stop</button> <button id="skipb">skip</button> speed:<input type="range" id="spd" min="0" max="200" value="20" style="vertical-align:middle;"><br>
src:
<div class="wrapper">
<textarea id="src">++++++++++[->++++++++++>+++>++++++++++++>+++++>+++++++<<<<<]
>>>>>++.	H
<<<<+.		e
+++++++..	ll
+++.		o
>++.
>-.		w
<<.		o
+++.		r
------.		l
--------.	d
>>>----.
>>++[>+++++<-]>.	return
<[,.]			input</textarea><pre id="srcprv"></pre>
</div>
","inp:
<div class="wrapper">
<textarea id="inp">To use input command,
type here before run.</textarea><pre id="inpprv"></pre>
</div>
<pre id="log"></pre>

<script src="https://www.jacklmoore.com/js/autosize.min.js"></script>
<script>
'use strict';
btn.onclick=()=>{main();btn.disabled=true;}
stopb.onclick=()=>{if(btn.disabled)stopb.disabled=true;}
skipb.onclick=()=>{if(btn.disabled)skipb.disabled=true;}
autosize(src);src.oninput=()=>autosize.update(src);
autosize(inp);inp.oninput=()=>autosize.update(inp);
const main=()=>{
	mv.innerHTML='<div></div><p>0</p>';
	out.innerText='';log.innerText='';
	src.readOnly=true;inp.readOnly=true;srcprv.style.zIndex=2;inpprv.style.zIndex=2;
	var s=src.value.split('');
	var p=0,ps=0,pi=0,m=[0],l=[],tmp;
	const render=()=>{
		mv.firstChild.style.left=`${36*p}px`;
		if(mv.childNodes.length-2<p)mv.appendChild(document.createElement('p'));
		mv.childNodes[p+1].innerText=m[p];
		srcprv.innerHTML=src.value.substring(0,ps-1)+`<span class="caret">${src.value[ps-1]?src.value[ps-1]:''}</span>`;
		inpprv.innerHTML=inp.value.substring(0,pi-1)+`<span class="caret">${inp.value[pi-1]?inp.value[pi-1]:''}</span>`;
	}
	const post=()=>{
		btn.disabled=false;stopb.disabled=false;skipb.disabled=false;
		src.readOnly=false;inp.readOnly=false;srcprv.style.zIndex=0;inpprv.style.zIndex=0;
	}
	const core=()=>{
		tmp=null;
		switch(s[ps]){
			case'>':p++;ps++;break;
			case'<':if(p>0)p--;else log.innerText+=ps+': invailed "<". skipped.\n';ps++;break;
			case'+':m[p]++;if(m[p]==256)m[p]=0;ps++;break;
			case'-':m[p]--;if(m[p]==-1)m[p]=255;ps++;break;
			case'.':out.innerText+=String.fromCharCode(m[p]);ps++;break;
			case',':tmp=inp.value.charCodeAt(pi);if(isNaN(tmp)){m[p]=0;log.innerText+=ps+': input empty. use 0 as input.\n';ps++;}else if(tmp>255)pi++;else{m[p]=tmp;pi++;ps++;}tmp=null;break;
			case'[':l.push(ps);ps++;break;
			case']':if(l.length){if(m[p]==0){l.pop();ps++;}else ps=l[l.length-1]+1;}else{log.innerText+=ps+': invailed "]". skipped.\n';ps++;}break;
			default:ps++;tmp=1;break;
		}
		if(m[p]==undefined)m[p]=0;if(!tmp)render();
		if(ps==s.length||stopb.disabled==true)setTimeout(post,spd.value);
		else{if(skipb.disabled||tmp)core();else setTimeout(core,spd.value);}
	};if(s.length)core();else setTimeout(post,spd.value);
}
</script>
</body>
</html>
