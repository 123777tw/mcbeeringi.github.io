<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<!-- <script async src="https://mcbeeringi.github.io/src/gas.js"></script> -->

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>McbeEringi brainf</title>
	<meta name="description" content="brainf*** encoder & interpreter">
	<link rel="icon" type="image/svg+xml" href="../img/icon.svg">
	<link rel="apple-touch-icon" href="../img/icon.png">
	<meta name="theme-color" content="#214"/>

	<link rel="stylesheet" href="../src/style.css">
</head>
<body>
<pre id="log"></pre>
<script>
const
m=new WebAssembly.Memory({initial:1,maximum:2,shared:1});

(async()=>(

self.wa=(`++++++++++++++[>+++++>+++++++>++>++++++<<<<-]>++.>+++.+++++++..+++.>++++.>+++.<<.+++.------.--------.>+.104`.match(/[><]+|[\+\-]+|\.+|[\,\[\]]/g)||[]).flatMap(x=>({
	'>':_=>(_=x.length-(x.match(/</g)||[]).length*2),
	'<':_=>(_=x.length-(x.match(/</g)||[]).length*2),
	'+':_=>(_=x.length-(x.match(/\-/g)||[]).length*2),
	'-':_=>(_=x.length-(x.match(/\-/g)||[]).length*2),
	'.':_=>x,
	',':_=>x,
	'[':_=>x,
	']':_=>x
})[x[0]]()),

console.log(wa),

wa=await WebAssembly.instantiate(new Uint8Array(`
00 61 73 6d 01 00 00 00
01 05 01 type
	60 00 01 7f
02 0b 01 import
	03 65 6e 76  01 6d 02 03 01 02
03 02 01 function
	00
07 05 01 export
	01 61 00 00
0a 09 01 code
	07
		00 41 00 28 02 00 0b
`.match(/\b[\da-fA-F]{2}\b/g).map(x=>parseInt(x,16))).buffer,{
	env:{m}
}),

console.log(
	wa.instance.exports.a,
	wa.instance.exports.a(),
	new Uint8Array(m.buffer)[0]=1,
	wa.instance.exports.a()
)

))();
</script>
</body>
</html>
