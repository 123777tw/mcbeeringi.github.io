<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-145066191-2"></script>
	<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-145066191-2');</script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>McbeEringi minimap</title>
</head>
<body>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>
	<style>
		:root{font-family:monospace;background:#222;color:#fff;tab-size:2;image-rendering:pixelated;}:link{color:#8cf;}
	</style>

	<h1>minimap</h1>
	<input type="file" id="inp">
	<div id="dl"></div>
	<pre><code id="out">console.log('Hello World!');</code></pre>
	<script>
		'use strict';
		const minimap=(e=document.body,c=document.createElement('canvas'))=>{
			e.style.position='fixed';e.style.top='0';e.style.left='0';e.style.transform='translateX(-100%)';
			const size=0.2;
			const ctx=c.getContext('2d'),
				dat=[],
				core=x=>{
					const b=x.getBoundingClientRect(),
						s=window.getComputedStyle(x);
					dat.push({
						box:[
							b.x+(dat[0]||{box:[0,0,b.width]}).box[2],
							b.y,
							b.width,
							b.height
						],
						col0:s.backgroundColor,
						col1:s.color
					});
					[...x.children].forEach(core);
				};
				core(e);
				console.log(dat);
				c.width=dat[0].box[2]*size;
				c.height=dat[0].box[3]*size;
				dat.forEach(x=>{
					ctx.fillStyle=x.col0;ctx.fillRect(...x.box.map(y=>Math.round(y*size)));
					if(dat[0].col1!=x.col1)ctx.fillStyle=x.col1;ctx.fillRect(...x.box.map(y=>Math.round(y*size)));
				});
				e.style='';
			return c;
		};
		hljs.highlightAll();
		inp.onchange=()=>{
			out.classList=(inp.files[0].name.match(/\.\w+$/)||[' plaintext'])[0].slice(1);
			inp.files[0].text().then(x=>{
				out.textContent=x;
				hljs.highlightAll();
				document.body.appendChild(minimap(out));
			})
		};
	</script>
</body>
</html>
