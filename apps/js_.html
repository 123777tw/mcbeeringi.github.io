<!DOCTYPE html>
<html lang='en' dir='ltr'>
<head>
	<script async src="https://mcbeeringi.github.io/src/gas.js"></script>

	<meta charset='utf-8'>
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>McbeEringi JavaScript</title>
	<meta name="description" content="js sandbox">
	<link rel="shortcut icon" type="image/svg+xml" href="../img/icon.svg">
	<link rel="apple-touch-icon" href="../img/icon.png">
	<meta name="theme-color" content="#214"/>

	<link rel="stylesheet" href="../src/style.css">
</head>
<body>
	<h1>JavaScript</h1>
	<hr>
	<textarea class="input" style="font-family:monospace;width:100%;"></textarea>
	<hr>
	<button class="button">run</button>
	<button class="button">save</button>
	<button class="button">copy url</button>
	<button class="button">copy runner</button>
	<pre style="white-space:pre-wrap;word-break:break-all;tab-size:2;"></pre>
	<hr>
	<script type="module">
		import TA from'https://mcbeeringi.github.io/ta/ta+.mjs';
		const pre=document.querySelector('pre'),
			btn=document.querySelectorAll('button'),
			ta=document.querySelector('textarea'),
			llog=x=>{
				const fx=y=>`\n<span style="opacity:0.5;">\t${Object.prototype.toString.call(y).slice(8,-1)}\t</span>${y.toString()}`,
					time=()=>{const d=new Date();return `[${d.toLocaleTimeString()}.${String(d.getMilliseconds()).padStart(3,0)}]`;};
				pre.insertAdjacentHTML('beforeend',`<span style="opacity:0.5;">${time()}</span>${x.map(fx).join('')}\n`);
			},
			ntv={...console};
		ta.value='console.clear();\nconsole.log("Hello World.");\n\n\n\n\n\n';
		TA.editor(ta);
		console.clear=()=>pre.textContent='';
		console.warn=(...x)=>{ntv.warn(...x);llog(x);};
		console.info=(...x)=>{ntv.info(...x);llog(x);};
		console.error=(...x)=>{ntv.error(...x);llog(x);};
		console.log=(...x)=>{ntv.log(...x);llog(x);};
		btn[0].onclick=()=>{try{Function(ta.value)();}catch(e){console.error(e);}};
		btn[1].onclick=()=>{location.hash=encodeURIComponent(ta.value).replace(/\(/g,'%28').replace(/\)/g,'%29');console.log('saved!');};
		btn[2].onclick=()=>navigator.clipboard.writeText(location.href).then(()=>console.log('url copied!'));
		btn[3].onclick=()=>navigator.clipboard.writeText('https://mcbeeringi.github.io/apps/jsrun.html'+location.hash).then(()=>console.log('runner copied!'));
		document.addEventListener('keydown',e=>{if((e.metaKey||e.ctrlKey)&&e.code=='KeyS'){e.preventDefault();btn[1].click();}})
		location.hash&&(ta.value=decodeURIComponent(location.hash.slice(1)),TA.ah(ta));
		btn[0].onclick();
	</script>
</body>
</html>
