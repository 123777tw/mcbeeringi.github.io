<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<title>McbeEringi langton's ant</title>
</head>
<body>
<style>
	:root{background-color:#222;color:#fff;tab-size:2;image-rendering:crisp-edges;image-rendering:pixelated;}
	#c{width:100%;}textarea{width:100%;}
</style>
size:<input id="size" type="number" value="512"><br>
ants:{p:[x,y],r:rad/PI}<textarea id="ants">[
	{"p":[256,256],"r":0}
]</textarea><br>
grid:{c:"rrggbbaa",r:rad/PI}<textarea id="grid">[
	{"c":"00000000","r":-0.5},
	{"c":"ff0000ff","r":-0.5},
	{"c":"00ff00ff","r":0.5},
	{"c":"0000ffff","r":0.5},
	{"c":"ffff00ff","r":-0.5},
	{"c":"ff00ffff","r":0.5},
	{"c":"00ffffff","r":-0.5},
	{"c":"ffffffff","r":0.5}
]</textarea>
<button onclick="init()">set</button>
<button onclick="if(!timer)timer=setInterval(main,1);">run</button>
<button onclick="clearInterval(timer);timer=0;">stop</button>
<pre id="log"></pre>
<canvas id="c"></canvas>
<script src="https://cdn.jsdelivr.net/npm/autosize/dist/autosize.min.js"></script>
<script>
let ctx=c.getContext('2d'),pli,colli,timer;
ctx.imageSmoothingEnabled=false;
[ants,grid].forEach(x=>{autosize(x);x.oninput=()=>autosize.update(x);});
const init=()=>{
	c.width=c.height=size.value;
	pli=JSON.parse(ants.value);
	colli=JSON.parse(grid.value);
	ctx.fillStyle=`#${colli[0].c}`;
	ctx.fillRect(0,0,c.width,c.height);
},
main=()=>{
	log.textContent='';
	pli.forEach(x=>{
		let tmp=Array.from(ctx.getImageData(...x.p,1,1).data,y=>y.toString(16).padStart(2,'0')).join('');
		log.textContent+=`${JSON.stringify(x)}\n\t${tmp}`;
		tmp=colli.findIndex(x=>x.c==tmp);
		if(tmp<0)ctx.clearRect(...x.p,1,1);
		else{
			tmp=[tmp,(tmp+1)%colli.length];
			ctx.fillStyle=`#${colli[tmp[1]].c}`;
			ctx.clearRect(...x.p,1,1)
			ctx.fillRect(...x.p,1,1);
			x.r=(x.r+colli[tmp[0]].r)%2;
			x.p=[x.p[0]+Math.cos(x.r*Math.PI),x.p[1]+Math.sin(x.r*Math.PI)];
		}
	});
};
init();
timer=setInterval(main,1);
</script>
</body>
</html>
