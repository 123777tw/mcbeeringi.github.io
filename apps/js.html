<!DOCTYPE html>
<html lang='en' dir='ltr'>
<head>
	<script async src="https://mcbeeringi.github.io/src/gas.js"></script>

	<meta charset='utf-8'>
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>McbeEringi JavaScript</title>
	<meta name="description" content="js sandbox">
	<link rel="icon" type="image/svg+xml" href="../img/icon.svg">
	<link rel="apple-touch-icon" href="../img/icon.png">
	<meta name="theme-color" content="#214"/>

	<link rel="stylesheet" href="../src/style.css">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror/lib/codemirror.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror/theme/monokai.min.css">
	<script src="https://cdn.jsdelivr.net/npm/codemirror/lib/codemirror.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/codemirror/mode/javascript/javascript.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/codemirror/addon/edit/matchbrackets.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/codemirror/addon/edit/closebrackets.min.js"></script>
</head>
<body>
	<h1>JavaScript</h1>
	<style>.CodeMirror{height:auto;}</style>
	<hr>
	<div></div>
	<hr>
	<button class="button">run</button>
	<button class="button">save</button>
	<button class="button">copy url</button>
	<button class="button">copy runner</button>
	<pre style="white-space:pre-wrap;word-break:break-all;tab-size:2;"></pre>
	<hr>
	<script>
	{
		const pre=document.querySelector('pre'),
			btn=document.querySelectorAll('button'),
			cm=CodeMirror(document.querySelector('div'),{
				value:'console.clear();\nconsole.log("Hello World.");\n\n\n\n\n\n',mode:'javascript',theme:'monokai',
				lineNumbers:true,tabSize:2,indentWithTabs:true,matchBrackets:true,autoCloseBrackets: true,
			}),
			llog=x=>{
				const fx=y=>`\n<span style="opacity:0.5;">\t${Object.prototype.toString.call(y).slice(8,-1)}\t</span>${y.toString()}`,
					time=()=>{const d=new Date();return `[${d.toLocaleTimeString()}.${String(d.getMilliseconds()).padStart(3,0)}]`;};
				pre.insertAdjacentHTML('beforeend',`<span style="opacity:0.5;">${time()}</span>${x.map(fx).join('')}\n`);
			},
			ntv={...console};
		console.clear=()=>pre.textContent='';
		console.warn=(...x)=>{ntv.warn(...x);llog(x);};
		console.info=(...x)=>{ntv.info(...x);llog(x);};
		console.error=(...x)=>{ntv.error(...x);llog(x);};
		console.log=(...x)=>{ntv.log(...x);llog(x);};
		btn[0].onclick=()=>{try{Function(cm.getValue())();}catch(e){console.error(e);}};
		btn[1].onclick=()=>{location.hash=encodeURIComponent(cm.getValue()).replace(/\(/g,'%28').replace(/\)/g,'%29');console.log('saved!');};
		btn[2].onclick=()=>navigator.clipboard.writeText(location.href).then(()=>console.log('url copied!'));
		btn[3].onclick=()=>navigator.clipboard.writeText('https://mcbeeringi.github.io/apps/jsrun.html'+location.hash).then(()=>console.log('runner copied!'));
		document.addEventListener('keydown',e=>{if((e.metaKey||e.ctrlKey)&&e.code=='KeyS'){e.preventDefault();btn[1].click();}})
		if(location.hash)cm.setValue(decodeURIComponent(location.hash.slice(1)));
		btn[0].onclick();
	}
	</script>
</body>
</html>
